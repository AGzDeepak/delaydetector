<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="{% block meta_description %}Track opportunity awareness delays and improve equal access with data-driven insights.{% endblock %}">
    <link rel="canonical" href="{{ canonical_url }}">
    <meta property="og:type" content="website">
    <meta property="og:title" content="{{ self.title()|striptags }}">
    <meta property="og:description" content="{% block og_description %}Track opportunity awareness delays and improve equal access with data-driven insights.{% endblock %}">
    <meta property="og:url" content="{{ canonical_url }}">
    <meta property="og:site_name" content="Awareness Delay">
    {% if google_site_verification %}
    <meta name="google-site-verification" content="{{ google_site_verification }}">
    {% endif %}
    <title>{% block title %}Awareness Delay{% endblock %}</title>
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body class="{% block body_class %}{% endblock %}">
    <header class="site-header">
      <div class="topbar">
        <a class="brand" href="/" title="Awareness Delay">
          <span class="brand-mark">A</span>
          <span class="brand-text">Get Update</span>
        </a>
        <button class="mobile-menu-btn" type="button" aria-controls="siteNav" aria-expanded="false">Menu</button>
        <form class="site-search" action="/opportunities" method="GET" role="search">
          <input type="text" name="search" placeholder="Search opportunities, companies, roles">
          <button type="submit">Search</button>
        </form>
        <div class="top-right">
          <div class="top-actions">
            <a class="icon-link" href="/saved" title="Saved opportunities">Saved</a>
            <a class="icon-link" href="/alerts" title="Your alerts">Alerts</a>
            <span class="user-pill" title="Public access">Public access</span>
          </div>
          <div class="top-datetime" id="topDateTime" aria-live="polite"></div>
        </div>
      </div>
      <nav class="site-nav" id="siteNav">
        <a href="/" class="nav-pill {% if request.path == '/' %}active{% endif %}">Home</a>
        <a href="/opportunities" class="nav-pill {% if request.path.startswith('/opportunities') %}active{% endif %}">Opportunities</a>
        <a href="/submit" class="nav-pill {% if request.path.startswith('/submit') %}active{% endif %}">Report Delay</a>
        <a href="/dashboard" class="nav-pill {% if request.path.startswith('/dashboard') %}active{% endif %}">Dashboard</a>
        <a href="/insights" class="nav-pill {% if request.path.startswith('/insights') %}active{% endif %}">Insights</a>
      </nav>
    </header>
    <main>
      {% if g.get('needs_acknowledgement') %}
      <div class="ack-banner">
        <form method="POST" action="/acknowledge" class="ack-form">
          <label class="ack-label">
            <input type="checkbox" required>
            I understand that information delay can create inequality in access to opportunities.
          </label>
          <input type="hidden" name="next" value="{{ request.path }}">
          <button type="submit" class="btn ack-btn">Continue →</button>
        </form>
      </div>
      {% endif %}
      <div class="page-container">
        {% block content %}{% endblock %}
      </div>
    </main>
    <footer>
      <small>Measure delay. Expose inequality.</small>
    </footer>
    <script>
      (function () {
        const el = document.getElementById('topDateTime');
        if (!el) return;
        const update = () => {
          const now = new Date();
          const date = now.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: '2-digit' });
          const time = now.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
          el.textContent = `${date} · ${time}`;
        };
        update();
        setInterval(update, 60000);
      })();

      (function () {
        const header = document.querySelector('.site-header');
        const menuBtn = header ? header.querySelector('.mobile-menu-btn') : null;
        if (header && menuBtn && window.matchMedia) {
          const mobileQuery = window.matchMedia('(max-width: 768px)');
          const setMenuState = (open) => {
            header.classList.toggle('mobile-menu-open', open);
            menuBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
          };

          menuBtn.addEventListener('click', () => {
            const open = !header.classList.contains('mobile-menu-open');
            setMenuState(open);
            if (open) {
              header.classList.remove('mobile-nav-hidden');
            }
          });

          header.querySelectorAll('.site-nav a').forEach((link) => {
            link.addEventListener('click', () => {
              if (mobileQuery.matches) {
                setMenuState(false);
              }
            });
          });

          document.addEventListener('click', (event) => {
            if (!mobileQuery.matches) return;
            if (!header.contains(event.target)) {
              setMenuState(false);
            }
          });

          if (mobileQuery.addEventListener) {
            mobileQuery.addEventListener('change', () => {
              setMenuState(false);
            });
          }
        }

        if (!header || !window.matchMedia) return;
        const mobileQuery = window.matchMedia('(max-width: 768px)');
        let lastY = window.scrollY || 0;
        let ticking = false;

        const syncHeaderVisibility = () => {
          const y = window.scrollY || 0;
          if (!mobileQuery.matches) {
            header.classList.remove('mobile-nav-hidden');
            lastY = y;
            ticking = false;
            return;
          }
          if (header.classList.contains('mobile-menu-open')) {
            header.classList.remove('mobile-nav-hidden');
            lastY = y;
            ticking = false;
            return;
          }
          if (y <= 8) {
            header.classList.remove('mobile-nav-hidden');
          } else if (y > lastY + 4) {
            header.classList.add('mobile-nav-hidden');
          } else if (y < lastY - 4) {
            header.classList.remove('mobile-nav-hidden');
          }
          lastY = y;
          ticking = false;
        };

        window.addEventListener('scroll', () => {
          if (!ticking) {
            window.requestAnimationFrame(syncHeaderVisibility);
            ticking = true;
          }
        }, { passive: true });

        if (mobileQuery.addEventListener) {
          mobileQuery.addEventListener('change', () => {
            header.classList.remove('mobile-nav-hidden');
            lastY = window.scrollY || 0;
          });
        }
      })();
    </script>
  </body>
</html>
