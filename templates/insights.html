{% extends 'base.html' %}
{% block title %}Insights Â· Awareness Delay{% endblock %}
{% block content %}
<div class="insights-container">
  <div class="insights-header glass-surface">
    <h2>ğŸ’¡ System Insights & Analytics</h2>
    <p class="subtitle">Data-driven insights about opportunity awareness inequality</p>
  </div>

  {% if insights and insights|length > 0 %}
    <!-- Key Metrics Dashboard -->
    {% if insights_data %}
    <div class="metrics-dashboard">
      <div class="metric-box">
        <div class="metric-label">Total Submissions</div>
        <div class="metric-number">{{ insights_data.total }}</div>
        <div class="metric-sub">records analyzed</div>
      </div>
      <div class="metric-box">
        <div class="metric-label">Avg Delay</div>
        <div class="metric-number">{{ insights_data.avg_delay }}</div>
        <div class="metric-sub">days</div>
      </div>
      <div class="metric-box">
        <div class="metric-label">Opportunity Loss</div>
        <div class="metric-number">{{ (insights_data.avg_ratio|float * 100)|int }}%</div>
        <div class="metric-sub">of window</div>
      </div>
      <div class="metric-box">
        <div class="metric-label">Regions Covered</div>
        <div class="metric-number">{{ insights_data.regions }}</div>
        <div class="metric-sub">geographic areas</div>
      </div>
    </div>
    {% endif %}

    <!-- Main Insights Grid -->
    <div class="insights-grid">
      {% for i in insights %}
      <div class="insight-card fade-in" style="animation-delay: {{ loop.index0 * 0.1 }}s">
        <div class="insight-icon">
          {% if 'ğŸš¨' in i %}
            ğŸš¨
          {% elif 'âš ï¸' in i %}
            âš ï¸
          {% elif 'âœ…' in i %}
            âœ…
          {% elif 'ğŸ“‰' in i %}
            ğŸ“‰
          {% elif 'ğŸ“ˆ' in i %}
            ğŸ“ˆ
          {% elif 'ğŸŒŸ' in i %}
            ğŸŒŸ
          {% elif 'ğŸ—ºï¸' in i %}
            ğŸ—ºï¸
          {% elif 'ğŸ“Š' in i %}
            ğŸ“Š
          {% else %}
            ğŸ’¡
          {% endif %}
        </div>
        <p class="insight-text">{{ i }}</p>
      </div>
      {% endfor %}
    </div>

    <!-- High Risk Regions -->
    {% if insights_data and insights_data.high_risk_regions %}
    <div class="risk-section glass-surface">
      <h3>ğŸ—ºï¸ Regional Risk Assessment</h3>
      <div class="risk-table">
        {% for region_data in insights_data.high_risk_regions %}
        <div class="risk-row">
          <div class="risk-region">{{ region_data.region }}</div>
          <div class="risk-bar">
            <div class="risk-fill" style="width: {{ region_data.late_pct|round(1) }}%; background: {% if region_data.late_pct > 70 %}#ef4444{% elif region_data.late_pct > 40 %}#f59e0b{% else %}#10b981{% endif %};"></div>
          </div>
          <div class="risk-value">{{ region_data.late_pct|round(1) }}% ({{ region_data.count }} submissions)</div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if insights_data %}
    <div class="risk-section glass-surface">
      <h3>India Region Breakdown</h3>
      <p class="region-note">Union Territories are listed under Central/Allâ€‘India. Mixed region submissions are counted once per matched region.</p>
      {% if insights_data.unknown_total %}
      <p class="region-note">Unknown region submissions: {{ insights_data.unknown_total }}. Encourage users to add a state/UT.</p>
      {% endif %}
      <div class="region-split">
        <div class="region-card">
          <h4>State Wise</h4>
          <div class="region-table">
            <div class="region-row region-head">
              <span>State</span><span>Capital</span><span>Total</span><span>Delay %</span><span>Avg Delay</span>
            </div>
            {% for s in insights_data.state_stats %}
            <div class="region-row">
              <span>{{ s.region }}</span>
              <span>{{ s.capital }}</span>
              <span>{{ s.total }}</span>
              <span>{{ s.late_pct }}%</span>
              <span>{{ s.avg_delay }} days</span>
            </div>
            {% endfor %}
            {% if not insights_data.state_stats %}
            <div class="region-row empty">No state data yet. Showing demo data below.</div>
            <div class="region-row demo">
              <span>Tamil Nadu</span>
              <span>Chennai</span>
              <span>12</span>
              <span>41.7%</span>
              <span>8.6 days</span>
            </div>
            <div class="region-row demo">
              <span>Maharashtra</span>
              <span>Mumbai</span>
              <span>9</span>
              <span>33.3%</span>
              <span>6.2 days</span>
            </div>
            <div class="region-row demo">
              <span>West Bengal</span>
              <span>Kolkata</span>
              <span>7</span>
              <span>28.6%</span>
              <span>5.4 days</span>
            </div>
            {% endif %}
          </div>
        </div>
        <div class="region-card">
          <h4>Central / All-India</h4>
          <div class="region-table">
            <div class="region-row region-head">
              <span>Region</span><span>Capital</span><span>Total</span><span>Delay %</span><span>Avg Delay</span>
            </div>
            {% for c in insights_data.central_stats %}
            <div class="region-row">
              <span>{{ c.region }}</span>
              <span>{{ c.capital }}</span>
              <span>{{ c.total }}</span>
              <span>{{ c.late_pct }}%</span>
              <span>{{ c.avg_delay }} days</span>
            </div>
            {% endfor %}
            {% if not insights_data.central_stats %}
            <div class="region-row empty">No central data yet. Showing demo data below.</div>
            <div class="region-row demo">
              <span>All India</span>
              <span>New Delhi</span>
              <span>15</span>
              <span>46.7%</span>
              <span>9.1 days</span>
            </div>
            <div class="region-row demo">
              <span>Central</span>
              <span>New Delhi</span>
              <span>10</span>
              <span>30.0%</span>
              <span>6.8 days</span>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Data Quality & Call to Action -->
    <div class="insights-footer glass-surface">
      <p class="insights-footer-note">
        ğŸ“Š These insights are generated from aggregated, anonymized user submissions
      </p>
      <p class="insights-footer-links">
        ğŸ”„ <a href="/submit">Submit more data</a> to improve accuracy â€¢ 
        <a href="/dashboard">View full dashboard</a>
      </p>
    </div>

  {% else %}
  <!-- Empty State -->
  <div class="empty-state">
    <div class="empty-icon">ğŸ“­</div>
    <h3>No Insights Available Yet</h3>
    <p>Submit opportunity awareness data to help us generate insights about awareness inequality.</p>
    <a href="/submit" class="btn insights-empty-btn">
      ğŸ“ Submit Your First Entry
    </a>
  </div>
  {% endif %}
</div>
{% endblock %}
